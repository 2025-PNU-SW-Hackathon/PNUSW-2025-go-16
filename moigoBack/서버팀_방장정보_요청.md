# π“‹ μ„λ²„ν€ λ°©μ¥ μ •λ³΄ λ¬Έμ  ν•΄κ²° μ™„λ£ λ³΄κ³ μ„

## π› λ°κ²¬λ λ¬Έμ 

### **ChatRoomDTOμ sender_id λ¨νΈν•¨**
- **κΈ°μ΅΄ κ°€μ •**: `sender_id` = λ¨μ„ μƒμ„±μ(λ°©μ¥) 
- **μ‹¤μ  μƒν™©**: `sender_id` = λ§μ§€λ§‰ λ©”μ‹μ§€ λ³΄λ‚Έ μ‚¬λ π±
- **κ²°κ³Ό**: λ§μ§€λ§‰μ— λ©”μ‹μ§€λ¥Ό λ³΄λ‚Έ μ‚¬λμ΄ λ°©μ¥μΌλ΅ μλ» μΈμ‹λ¨

## β… ν•΄κ²° μ™„λ£ μ‚¬ν•­

### **1. μ±„ν…λ°© λ©λ΅ API κ°μ„ **

**μμ •λ μ‘λ‹µ κµ¬μ΅°:**
```json
{
  "success": true,
  "data": [
    {
      "chat_room_id": "5",
      "name": "μ¶•κµ¬ μ‹μ²­ λ¨μ„",
      "host_id": "test1",                    // π†• μ‹¤μ  λ¨μ„ μƒμ„±μ (λ°©μ¥)
      "last_message": "μ•λ…•ν•μ„Έμ”",
      "last_message_time": "2024-01-15T14:30:00.000Z",
      "last_message_sender_id": "test4",     // π”§ λ…ν™•ν• λ„¤μ΄λ° (λ§μ§€λ§‰ λ©”μ‹μ§€ λ³΄λ‚Έ μ‚¬λ)
      "sender_id": "test4",                  // π”§ ν•μ„ νΈν™μ„± μ μ§€
      "is_host": false,                      // π†• ν„μ¬ μ‚¬μ©μκ°€ λ°©μ¥μΈμ§€ μ—¬λ¶€
      "user_role": "μ°Έκ°€μ"                   // π†• ν„μ¬ μ‚¬μ©μ μ—­ν•  ("λ°©μ¥" or "μ°Έκ°€μ")
    }
  ]
}
```

### **2. μ±„ν…λ°© λ©”μ‹μ§€ API κ°μ„ **

**μμ •λ μ‘λ‹µ κµ¬μ΅°:**
```json
{
  "success": true,
  "data": [
    {
      "id": 123,
      "sender_id": "test4",
      "message": "μ•λ…•ν•μ„Έμ”!",
      "created_at": "2024-01-15T14:30:00.000Z",
      "user_name": "κΉ€μ² μ",                  // π†• λ©”μ‹μ§€ λ³΄λ‚Έ μ‚¬μ©μ μ΄λ¦„
      "is_sender_host": false,               // π†• λ©”μ‹μ§€ λ³΄λ‚Έ μ‚¬λμ΄ λ°©μ¥μΈμ§€
      "sender_role": "μ°Έκ°€μ",                // π†• λ©”μ‹μ§€ λ³΄λ‚Έ μ‚¬λ μ—­ν• 
      "current_user_is_host": true,          // π†• ν„μ¬ μ‚¬μ©μκ°€ λ°©μ¥μΈμ§€
      "read_count": 2,
      "message_type": "user_message"
    }
  ]
}
```

### **3. ν–¥μƒλ λ°©μ¥ νλ³„ λ΅μ§**

**λ°μ΄ν„°λ² μ΄μ¤ μ΅°μΈ:**
- `reservation_table.user_id` = μ‹¤μ  λ¨μ„ μƒμ„±μ (λ°©μ¥)
- `chat_messages.sender_id` = λ§μ§€λ§‰ λ©”μ‹μ§€ λ³΄λ‚Έ μ‚¬λ

**μ„λ²„ λ΅κ·Έ κ°μ„ :**
```bash
π” [DEBUG] μ±„ν…λ°© μ •λ³΄: {
  chat_room_id: "5",
  name: "μ¶•κµ¬ μ‹μ²­ λ¨μ„",
  host_id: "test1",           // μ‹¤μ  λ°©μ¥
  current_user: "test4",      // ν„μ¬ μ‚¬μ©μ
  role: "μ°Έκ°€μ",              // ν„μ¬ μ‚¬μ©μ μ—­ν• 
  last_message_sender: "test4" // λ§μ§€λ§‰ λ©”μ‹μ§€ λ³΄λ‚Έ μ‚¬λ
}

π“ [DEBUG] λ©”μ‹μ§€ μ²λ¦¬: {
  message_id: 123,
  sender_id: "test4",
  sender_name: "κΉ€μ² μ",
  is_sender_host: false,       // λ©”μ‹μ§€ λ³΄λ‚Έ μ‚¬λμ΄ λ°©μ¥μΈμ§€
  sender_role: "μ°Έκ°€μ",
  current_user_is_host: true   // ν„μ¬ μ‚¬μ©μκ°€ λ°©μ¥μΈμ§€
}
```

## π― ν΄λΌμ΄μ–ΈνΈ ν™μ© λ°©λ²•

### **1. μ±„ν…λ°© λ©λ΅μ—μ„ λ°©μ¥ κµ¬λ¶„**
```typescript
chatRooms.forEach(room => {
  if (room.is_host) {
    // ν„μ¬ μ‚¬μ©μκ°€ λ°©μ¥μΈ κ²½μ°
    showHostFeatures(room); // κ²°μ  μ”μ²­, μ‚¬μ©μ κ°•ν‡΄ λ“±
  } else {
    // μΌλ° μ°Έκ°€μμΈ κ²½μ°
    showParticipantFeatures(room); // κΈ°λ³Έ μ±„ν… κΈ°λ¥λ§
  }
});
```

### **2. λ©”μ‹μ§€μ—μ„ λ°©μ¥ ν‘μ‹**
```typescript
messages.forEach(message => {
  const senderBadge = message.is_sender_host ? 'π‘‘ λ°©μ¥' : '';
  const currentUserBadge = message.current_user_is_host ? '(λ‚λ” λ°©μ¥)' : '';
  
  displayMessage({
    ...message,
    senderBadge,
    currentUserBadge
  });
});
```

### **3. κ¶ν• κΈ°λ° UI μ μ–΄**
```typescript
// λ°©μ¥λ§ ν•  μ μλ” κΈ°λ¥λ“¤
if (currentUserIsHost) {
  showPaymentRequestButton();
  showKickUserButton();
  showReservationManageButton();
}
```

## π”§ κΈ°μ μ  κµ¬ν„ μ‚¬ν•­

### **λ°μ΄ν„°λ² μ΄μ¤ μΏΌλ¦¬ μµμ ν™”**
- `reservation_table` μ΅°μΈμΌλ΅ μ‹¤μ  λ°©μ¥ μ •λ³΄ μ΅°ν
- ν•μ„ νΈν™μ„±μ„ μ„ν•΄ κΈ°μ΅΄ `sender_id` ν•„λ“ μ μ§€
- λ…ν™•ν• λ„¤μ΄λ°μ„ μ„ν•΄ `last_message_sender_id` μ¶”κ°€

### **ν•μ„ νΈν™μ„± λ³΄μ¥**
- κΈ°μ΅΄ ν΄λΌμ΄μ–ΈνΈλ„ `sender_id` ν•„λ“λ΅ κ³„μ† μ‘λ™
- μƒλ΅μ΄ ν΄λΌμ΄μ–ΈνΈλ” `host_id`, `is_host` ν•„λ“ ν™μ©
- μ μ§„μ  λ§μ΄κ·Έλ μ΄μ… κ°€λ¥

## π€ λ°°ν¬ ν›„ ν™•μΈμ‚¬ν•­

1. **μ±„ν…λ°© λ©λ΅**: `host_id`κ°€ μ‹¤μ  λ¨μ„ μƒμ„±μμ™€ μΌμΉν•λ”μ§€ ν™•μΈ
2. **λ°©μ¥ ν‘μ‹**: λ©”μ‹μ§€μ—μ„ λ°©μ¥ λ°°μ§€κ°€ μ¬λ°”λ¥΄κ² ν‘μ‹λλ”μ§€ ν™•μΈ  
3. **κ¶ν• μ μ–΄**: λ°©μ¥λ§ κ²°μ  μ”μ²­/μ‚¬μ©μ κ°•ν‡΄ κ°€λ¥ν•μ§€ ν™•μΈ
4. **λ΅κ·Έ λ¨λ‹ν„°λ§**: λ°©μ¥ νλ³„ λ΅μ§μ΄ μ •μƒ μ‘λ™ν•λ”μ§€ ν™•μΈ

## π“ μμƒ ν¨κ³Ό

- β… **μ •ν™•ν• λ°©μ¥ κµ¬λ¶„**: λ§μ§€λ§‰ λ©”μ‹μ§€μ™€ λ¬΄κ΄€ν•κ² μ‹¤μ  λ¨μ„ μƒμ„±μ μ‹λ³„
- β… **ν–¥μƒλ UX**: λ°©μ¥/μ°Έκ°€μ μ—­ν•  λ…ν™•ν ν‘μ‹
- β… **κ¶ν• κ΄€λ¦¬**: λ°©μ¥ μ „μ© κΈ°λ¥ μ •ν™•ν μ μ–΄
- β… **λ””λ²„κΉ… μ©μ΄**: μƒμ„Έν• λ΅κ·Έλ΅ λ¬Έμ  μ¶”μ  κ°€λ¥

---

**π‰ λ¬Έμ  ν•΄κ²° μ™„λ£! μ΄μ  μ±„ν…λ°©μ—μ„ λ°©μ¥κ³Ό μ°Έκ°€μλ¥Ό μ •ν™•ν κµ¬λ¶„ν•  μ μμµλ‹λ‹¤.**
