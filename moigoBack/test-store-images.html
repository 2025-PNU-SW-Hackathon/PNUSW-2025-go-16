<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°€ê²Œ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        input, button { margin: 5px; padding: 8px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>ğŸª ê°€ê²Œ ì´ë¯¸ì§€ API í…ŒìŠ¤íŠ¸</h1>
    
    <div class="section">
        <h3>ğŸ”‘ JWT í† í° ì„¤ì •</h3>
        <input type="text" id="jwtToken" placeholder="JWT í† í°ì„ ì…ë ¥í•˜ì„¸ìš”" style="width: 400px;">
        <button onclick="setToken()">í† í° ì„¤ì •</button>
        <div id="tokenStatus"></div>
    </div>

    <div class="section">
        <h3>ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ</h3>
        <input type="file" id="imageFiles" multiple accept="image/*">
        <button onclick="uploadImages()">ì´ë¯¸ì§€ ì—…ë¡œë“œ</button>
        <div id="uploadResult"></div>
    </div>

    <div class="section">
        <h3>ğŸ“‹ ì´ë¯¸ì§€ ëª©ë¡ ì¡°íšŒ</h3>
        <button onclick="getImages()">ì´ë¯¸ì§€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°</button>
        <div id="imagesResult"></div>
    </div>

    <div class="section">
        <h3>ğŸ”„ ì´ë¯¸ì§€ ìˆœì„œ ë³€ê²½</h3>
        <input type="text" id="imageOrder" placeholder="[123, 124, 125] í˜•íƒœë¡œ ì…ë ¥">
        <button onclick="reorderImages()">ìˆœì„œ ë³€ê²½</button>
        <div id="reorderResult"></div>
    </div>

    <div class="section">
        <h3>â­ ë©”ì¸ ì´ë¯¸ì§€ ì„¤ì •</h3>
        <input type="text" id="mainImageId" placeholder="ë©”ì¸ìœ¼ë¡œ ì„¤ì •í•  ì´ë¯¸ì§€ ID">
        <button onclick="setMainImage()">ë©”ì¸ ì´ë¯¸ì§€ ì„¤ì •</button>
        <div id="mainImageResult"></div>
    </div>

    <div class="section">
        <h3>ğŸ—‘ï¸ ì´ë¯¸ì§€ ì‚­ì œ</h3>
        <input type="text" id="deleteImageId" placeholder="ì‚­ì œí•  ì´ë¯¸ì§€ ID">
        <button onclick="deleteImage()">ì´ë¯¸ì§€ ì‚­ì œ</button>
        <div id="deleteResult"></div>
    </div>

    <div class="section">
        <h3>ğŸŒ ê³µê°œ ì´ë¯¸ì§€ ì¡°íšŒ</h3>
        <input type="text" id="publicStoreId" placeholder="ê°€ê²Œ ID">
        <button onclick="getPublicImages()">ê³µê°œ ì´ë¯¸ì§€ ì¡°íšŒ</button>
        <div id="publicImagesResult"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api/v1';
        let currentToken = '';

        function setToken() {
            currentToken = document.getElementById('jwtToken').value;
            if (currentToken) {
                document.getElementById('tokenStatus').innerHTML = '<span class="success">âœ… í† í°ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</span>';
            } else {
                document.getElementById('tokenStatus').innerHTML = '<span class="error">âŒ í† í°ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>';
            }
        }

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            if (isError) {
                element.innerHTML = `<div class="error">âŒ ${data}</div>`;
            } else {
                element.innerHTML = `<div class="success">âœ… ${JSON.stringify(data, null, 2)}</div>`;
            }
        }

        async function uploadImages() {
            if (!currentToken) {
                showResult('uploadResult', 'JWT í† í°ì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            const files = document.getElementById('imageFiles').files;
            if (files.length === 0) {
                showResult('uploadResult', 'ì—…ë¡œë“œí•  ì´ë¯¸ì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', true);
                return;
            }

            const formData = new FormData();
            for (let file of files) {
                formData.append('images', file);
            }

            try {
                const response = await fetch(`${API_BASE}/stores/me/images`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('uploadResult', result);
                } else {
                    showResult('uploadResult', result.message || 'ì—…ë¡œë“œ ì‹¤íŒ¨', true);
                }
            } catch (error) {
                showResult('uploadResult', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        async function getImages() {
            if (!currentToken) {
                showResult('imagesResult', 'JWT í† í°ì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/stores/me/images`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('imagesResult', result);
                } else {
                    showResult('imagesResult', result.message || 'ì¡°íšŒ ì‹¤íŒ¨', true);
                }
            } catch (error) {
                showResult('imagesResult', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        async function reorderImages() {
            if (!currentToken) {
                showResult('reorderResult', 'JWT í† í°ì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            const imageOrder = document.getElementById('imageOrder').value;
            if (!imageOrder) {
                showResult('reorderResult', 'ì´ë¯¸ì§€ ìˆœì„œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            try {
                const orderArray = JSON.parse(imageOrder);
                const response = await fetch(`${API_BASE}/stores/me/images/reorder`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ imageOrder: orderArray })
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('reorderResult', result);
                } else {
                    showResult('reorderResult', result.message || 'ìˆœì„œ ë³€ê²½ ì‹¤íŒ¨', true);
                }
            } catch (error) {
                showResult('reorderResult', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        async function setMainImage() {
            if (!currentToken) {
                showResult('mainImageResult', 'JWT í† í°ì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            const imageId = document.getElementById('mainImageId').value;
            if (!imageId) {
                showResult('mainImageResult', 'ì´ë¯¸ì§€ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/stores/me/images/${imageId}/main`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('mainImageResult', result);
                } else {
                    showResult('mainImageResult', result.message || 'ì„¤ì • ì‹¤íŒ¨', true);
                }
            } catch (error) {
                showResult('mainImageResult', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        async function deleteImage() {
            if (!currentToken) {
                showResult('deleteResult', 'JWT í† í°ì„ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            const imageId = document.getElementById('deleteImageId').value;
            if (!imageId) {
                showResult('deleteResult', 'ì´ë¯¸ì§€ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/stores/me/images/${imageId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('deleteResult', result);
                } else {
                    showResult('deleteResult', result.message || 'ì‚­ì œ ì‹¤íŒ¨', true);
                }
            } catch (error) {
                showResult('deleteResult', `ì—ëŸ¬: ${error.message}`, true);
            }
        }

        async function getPublicImages() {
            const storeId = document.getElementById('publicStoreId').value;
            if (!storeId) {
                showResult('publicImagesResult', 'ê°€ê²Œ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/stores/${storeId}/images`);
                const result = await response.json();
                
                if (response.ok) {
                    showResult('publicImagesResult', result);
                } else {
                    showResult('publicImagesResult', result.message || 'ì¡°íšŒ ì‹¤íŒ¨', true);
                }
            } catch (error) {
                showResult('publicImagesResult', `ì—ëŸ¬: ${error.message}`, true);
            }
        }
    </script>
</body>
</html>
