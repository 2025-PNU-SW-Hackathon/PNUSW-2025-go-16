<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>가게 이미지 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        input, button { margin: 5px; padding: 8px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 3px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>🏪 가게 이미지 API 테스트</h1>
    
    <div class="section">
        <h3>🔑 JWT 토큰 설정</h3>
        <input type="text" id="jwtToken" placeholder="JWT 토큰을 입력하세요" style="width: 400px;">
        <button onclick="setToken()">토큰 설정</button>
        <div id="tokenStatus"></div>
    </div>

    <div class="section">
        <h3>📤 이미지 업로드</h3>
        <input type="file" id="imageFiles" multiple accept="image/*">
        <button onclick="uploadImages()">이미지 업로드</button>
        <div id="uploadResult"></div>
    </div>

    <div class="section">
        <h3>📋 이미지 목록 조회</h3>
        <button onclick="getImages()">이미지 목록 가져오기</button>
        <div id="imagesResult"></div>
    </div>

    <div class="section">
        <h3>🔄 이미지 순서 변경</h3>
        <input type="text" id="imageOrder" placeholder="[123, 124, 125] 형태로 입력">
        <button onclick="reorderImages()">순서 변경</button>
        <div id="reorderResult"></div>
    </div>

    <div class="section">
        <h3>⭐ 메인 이미지 설정</h3>
        <input type="text" id="mainImageId" placeholder="메인으로 설정할 이미지 ID">
        <button onclick="setMainImage()">메인 이미지 설정</button>
        <div id="mainImageResult"></div>
    </div>

    <div class="section">
        <h3>🗑️ 이미지 삭제</h3>
        <input type="text" id="deleteImageId" placeholder="삭제할 이미지 ID">
        <button onclick="deleteImage()">이미지 삭제</button>
        <div id="deleteResult"></div>
    </div>

    <div class="section">
        <h3>🌐 공개 이미지 조회</h3>
        <input type="text" id="publicStoreId" placeholder="가게 ID">
        <button onclick="getPublicImages()">공개 이미지 조회</button>
        <div id="publicImagesResult"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api/v1';
        let currentToken = '';

        function setToken() {
            currentToken = document.getElementById('jwtToken').value;
            if (currentToken) {
                document.getElementById('tokenStatus').innerHTML = '<span class="success">✅ 토큰이 설정되었습니다.</span>';
            } else {
                document.getElementById('tokenStatus').innerHTML = '<span class="error">❌ 토큰을 입력해주세요.</span>';
            }
        }

        function showResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            if (isError) {
                element.innerHTML = `<div class="error">❌ ${data}</div>`;
            } else {
                element.innerHTML = `<div class="success">✅ ${JSON.stringify(data, null, 2)}</div>`;
            }
        }

        async function uploadImages() {
            if (!currentToken) {
                showResult('uploadResult', 'JWT 토큰을 먼저 설정해주세요.', true);
                return;
            }

            const files = document.getElementById('imageFiles').files;
            if (files.length === 0) {
                showResult('uploadResult', '업로드할 이미지를 선택해주세요.', true);
                return;
            }

            const formData = new FormData();
            for (let file of files) {
                formData.append('images', file);
            }

            try {
                const response = await fetch(`${API_BASE}/stores/me/images`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: formData
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('uploadResult', result);
                } else {
                    showResult('uploadResult', result.message || '업로드 실패', true);
                }
            } catch (error) {
                showResult('uploadResult', `에러: ${error.message}`, true);
            }
        }

        async function getImages() {
            if (!currentToken) {
                showResult('imagesResult', 'JWT 토큰을 먼저 설정해주세요.', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/stores/me/images`, {
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('imagesResult', result);
                } else {
                    showResult('imagesResult', result.message || '조회 실패', true);
                }
            } catch (error) {
                showResult('imagesResult', `에러: ${error.message}`, true);
            }
        }

        async function reorderImages() {
            if (!currentToken) {
                showResult('reorderResult', 'JWT 토큰을 먼저 설정해주세요.', true);
                return;
            }

            const imageOrder = document.getElementById('imageOrder').value;
            if (!imageOrder) {
                showResult('reorderResult', '이미지 순서를 입력해주세요.', true);
                return;
            }

            try {
                const orderArray = JSON.parse(imageOrder);
                const response = await fetch(`${API_BASE}/stores/me/images/reorder`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ imageOrder: orderArray })
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('reorderResult', result);
                } else {
                    showResult('reorderResult', result.message || '순서 변경 실패', true);
                }
            } catch (error) {
                showResult('reorderResult', `에러: ${error.message}`, true);
            }
        }

        async function setMainImage() {
            if (!currentToken) {
                showResult('mainImageResult', 'JWT 토큰을 먼저 설정해주세요.', true);
                return;
            }

            const imageId = document.getElementById('mainImageId').value;
            if (!imageId) {
                showResult('mainImageResult', '이미지 ID를 입력해주세요.', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/stores/me/images/${imageId}/main`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('mainImageResult', result);
                } else {
                    showResult('mainImageResult', result.message || '설정 실패', true);
                }
            } catch (error) {
                showResult('mainImageResult', `에러: ${error.message}`, true);
            }
        }

        async function deleteImage() {
            if (!currentToken) {
                showResult('deleteResult', 'JWT 토큰을 먼저 설정해주세요.', true);
                return;
            }

            const imageId = document.getElementById('deleteImageId').value;
            if (!imageId) {
                showResult('deleteResult', '이미지 ID를 입력해주세요.', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/stores/me/images/${imageId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${currentToken}`
                    }
                });

                const result = await response.json();
                if (response.ok) {
                    showResult('deleteResult', result);
                } else {
                    showResult('deleteResult', result.message || '삭제 실패', true);
                }
            } catch (error) {
                showResult('deleteResult', `에러: ${error.message}`, true);
            }
        }

        async function getPublicImages() {
            const storeId = document.getElementById('publicStoreId').value;
            if (!storeId) {
                showResult('publicImagesResult', '가게 ID를 입력해주세요.', true);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/stores/${storeId}/images`);
                const result = await response.json();
                
                if (response.ok) {
                    showResult('publicImagesResult', result);
                } else {
                    showResult('publicImagesResult', result.message || '조회 실패', true);
                }
            } catch (error) {
                showResult('publicImagesResult', `에러: ${error.message}`, true);
            }
        }
    </script>
</body>
</html>
